<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Configuration examples &mdash; MapProxy v0.8.4 documentation</title>
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '#',
        VERSION:     '0.8.4',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="MapProxy v0.8.4 documentation" href="index.html" />
    <link rel="next" title="Deployment" href="deployment.html" />
    <link rel="prev" title="Seeding" href="seed.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="deployment.html" title="Deployment"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="seed.html" title="Seeding"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">MapProxy v0.8.4 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="configuration-examples">
<h1>Configuration examples<a class="headerlink" href="#configuration-examples" title="Permalink to this headline">¶</a></h1>
<p>This document will show you some usage scenarios of MapProxy and will explain some combinations of configuration options that might be useful for you.</p>
<div class="section" id="merge-multiple-layers">
<h2>Merge multiple layers<a class="headerlink" href="#merge-multiple-layers" title="Permalink to this headline">¶</a></h2>
<p>You have two WMS and want to offer a single layer with data from both servers. Each MapProxy layer can have more than one data source. MapProxy will combine the results from the sources before it stores the cached tiles. These combined layers can also be requested via tiled services.</p>
<p>The layers should be defined from top to bottom. Top layers should be transparent.</p>
<p>Example:</p>
<div class="highlight-python"><pre>combined_layer:
  md:
    title: Aerial image + roads overlay
  sources:
  - type: cache_wms
    wms_opts:
      featureinfo: True
      version: 1.1.1
    req:
        url: http://one.example.org/mapserv/?map=/home/map/roads.map
        layers: roads
        transparent: true
  - type: cache_wms
    req:
        url: http://two.example.org/service?
        layers: aerial</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If the layers come from the same WMS server, you can just them to the <tt class="docutils literal"><span class="pre">layers</span></tt> parameter. E.g. <tt class="docutils literal"><span class="pre">layers:</span> <span class="pre">water,railroads,roads</span></tt>.</p>
</div>
</div>
<div class="section" id="access-local-servers">
<h2>Access local servers<a class="headerlink" href="#access-local-servers" title="Permalink to this headline">¶</a></h2>
<p>If a source is on the same host or connected with high bandwidth (i.e. LAN), you can use an uncompressed image format for requests to the source WMS. By default MapProxy will request data in the same format it uses to cache the data. For example, if you cache files in PNG MapProxy will request all images from the source WMS in PNG too. This compression is quite CPU intensive and can be avoided if you have plenty of bandwidth. Your source WMS should respond faster if you use uncompressed TIFF.</p>
<p>Example:</p>
<div class="highlight-python"><pre>fast_source:
  md:
    title: Map from local server
  params:
    request_format: image/tiff
  sources:
  - type: cache_wms
    req:
      url: http://localhost/mapserv/?map=/home/map/roads.map
      layers: roads
      transparent: true</pre>
</div>
</div>
<div class="section" id="cache-raster-data">
<h2>Cache raster data<a class="headerlink" href="#cache-raster-data" title="Permalink to this headline">¶</a></h2>
<p>You have a WMS server that offers raster data like aerial images. By default MapProxy uses PNG images as the caching format. The encoding process for PNG files is very computing intensive and thus the caching process itself takes longer. For aerial images the quality of lose-less image formats like PNG is often not required. For best performance you should use JPEG as the cache format:</p>
<div class="highlight-python"><pre>aerial_images:
  params:
    format: image/jpeg
  [sources and md omitted]</pre>
</div>
<p>By default MapProxy uses <cite>bicubic</cite> resampling. This resampling method also sharpens the image wich is important for vector images. Arial images do not need this, so you can use <cite>bilinear</cite> or even Nearest Neighbor (<cite>nearest</cite>) resampling.</p>
<p>You might also want to experiment with different compression levels of JPEG. A higher value of <tt class="docutils literal"><span class="pre">jpeg_quality</span></tt> results in better image quality at the cost of slower encoding and lager file sizes. See <a class="reference external" href="configuration.html#jpeg-quality"><em>proxy.yaml configuration</em></a>.</p>
<p>Example <tt class="docutils literal"><span class="pre">proxy.yaml</span></tt>:</p>
<div class="highlight-python"><pre>image:
  jpeg_quality: 80
  resampling: bilinear</pre>
</div>
</div>
<div class="section" id="cache-vector-data">
<h2>Cache vector data<a class="headerlink" href="#cache-vector-data" title="Permalink to this headline">¶</a></h2>
<p>You have a WMS server that renders vector data like road maps.</p>
<div class="section" id="cache-resolutions">
<h3>Cache resolutions<a class="headerlink" href="#cache-resolutions" title="Permalink to this headline">¶</a></h3>
<p>By default MapProxy caches traditional power-of-two image pyramids, the resolutions between each pyramid level doubles. For example if the first level has a resolution of 10km, it would also cache resolutions of 5km, 2.5km, 1.125km etc. Requests with a resolution of 7km would be generated from cached data with a resolution of 10km. The problem with this approach is, that everything needs to be scaled down, lines will get thin and text labels will become unreadable. The solution is simple: Just add more levels to the pyramid. There are three options to do this.</p>
<p>You can set every cache resolution in the <tt class="docutils literal"><span class="pre">res</span></tt> option of a layer.</p>
<div class="highlight-python"><pre>custom_res:
  params:
    res: [10000, 7500, 5000, 3500, 2500]
  [sources and md omitted]</pre>
</div>
<p>You can specify a different factor that is used to calculate the resolutions. By default a factor of 2 is used (10, 5, 2.5,…) but you can set smaller values like 1.6 (10, 6.25, 3.9,…):</p>
<div class="highlight-python"><pre>custom_factor:
  params:
    res: 1.6
  [sources and md omitted]</pre>
</div>
<p>The third options is a convenient variation of the previous option. A factor of 1.41421, the square root of two, would get resolutions of 10, 7.07, 5, 3.54, 2.5,…. Notice that every second resolution is identical to the power-of-two resolutions. This comes in handy if you use the layer not only in classic WMS clients but also want to use it in tile-based clients like OpenLayers, wich only request in these resolutions.</p>
<div class="highlight-python"><pre>sqrt2:
  params:
    res: sqrt2
  [sources and md omitted]</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The quality of aerial images or scanned maps are unaffected from these options.</p>
</div>
</div>
<div class="section" id="resampling-method">
<h3>Resampling method<a class="headerlink" href="#resampling-method" title="Permalink to this headline">¶</a></h3>
<p>You can configure the method MapProxy uses for resampling when it scales or transforms data. For best results with vector data – from a viewers perspective – you should use bicubic resampling. Your <tt class="docutils literal"><span class="pre">proxy.yaml</span></tt> should contain:</p>
<div class="highlight-python"><pre>image:
  resampling: bicubic</pre>
</div>
</div>
</div>
<div class="section" id="add-highly-dynamic-layers">
<h2>Add highly dynamic layers<a class="headerlink" href="#add-highly-dynamic-layers" title="Permalink to this headline">¶</a></h2>
<p>You have dynamic layers that change constantly and you do not want to cache these. You can use the <tt class="docutils literal"><span class="pre">direct</span></tt> source type. See next example.</p>
</div>
<div class="section" id="reproject-wms-layers">
<h2>Reproject WMS layers<a class="headerlink" href="#reproject-wms-layers" title="Permalink to this headline">¶</a></h2>
<p>If you do not want want to cache data but still want to use MapProxy&#8217;s ability to reproject WMS layers on the fly, you can add the layers as a <tt class="docutils literal"><span class="pre">direct</span></tt> layer.
You should explicitly define the SRS the source WMS supports. Requests in other SRS will be reprojected. You should specify at least one geographic and one projected SRS to limit the distortions from reprojection.</p>
<div class="highlight-python"><pre>direct_example:
  [md and params omitted]
  sources:
  - type: direct
    supported_srs: ['EPSG:4326', 'EPSG:25832']
    req:
      url: http://wms.example.org/service?
      layers: layer0,layer1</pre>
</div>
</div>
<div class="section" id="wms-layers-with-http-basic-authentication">
<h2>WMS layers with HTTP Basic Authentication<a class="headerlink" href="#wms-layers-with-http-basic-authentication" title="Permalink to this headline">¶</a></h2>
<p>You have a WMS source that requires authentication. MapProxy has support for HTTP Basic
Authentication. You just need to add the username and password to the URL. Since the
password is sent in plaintext, you should use this feature in combination with HTTPS.
See <a class="reference external" href="configuration.html#http-ssl"><em>HTTPS configuration for more information</em></a>.</p>
<div class="highlight-python"><pre>secure_source:
  md:
    title: Map from HTTPS server
  sources:
  - type: cache_wms
    req:
      url: https://username:mypassword@example.org/service?
      layers: securelayer</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <h3><a href="index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="#">Configuration examples</a><ul>
<li><a class="reference external" href="#merge-multiple-layers">Merge multiple layers</a></li>
<li><a class="reference external" href="#access-local-servers">Access local servers</a></li>
<li><a class="reference external" href="#cache-raster-data">Cache raster data</a></li>
<li><a class="reference external" href="#cache-vector-data">Cache vector data</a><ul>
<li><a class="reference external" href="#cache-resolutions">Cache resolutions</a></li>
<li><a class="reference external" href="#resampling-method">Resampling method</a></li>
</ul>
</li>
<li><a class="reference external" href="#add-highly-dynamic-layers">Add highly dynamic layers</a></li>
<li><a class="reference external" href="#reproject-wms-layers">Reproject WMS layers</a></li>
<li><a class="reference external" href="#wms-layers-with-http-basic-authentication">WMS layers with HTTP Basic Authentication</a></li>
</ul>
</li>
</ul>

            <h4>Previous topic</h4>
            <p class="topless"><a href="seed.html"
                                  title="previous chapter">Seeding</a></p>
            <h4>Next topic</h4>
            <p class="topless"><a href="deployment.html"
                                  title="next chapter">Deployment</a></p>
            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="_sources/configuration_examples.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="deployment.html" title="Deployment"
             >next</a> |</li>
        <li class="right" >
          <a href="seed.html" title="Seeding"
             >previous</a> |</li>
        <li><a href="index.html">MapProxy v0.8.4 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; Copyright 2010, Oliver Tonnhofer, Omniscale.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.5.
    </div>
  </body>
</html>